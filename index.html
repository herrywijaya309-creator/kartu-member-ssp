<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Member Card - Sumber Sari Patimura V24</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&family=Oswald:wght@500;700&display=swap" rel="stylesheet">

    <style>
        /* RESET CSS UNTUK WINDOWS */
        * { box-sizing: border-box; }
        body { font-family: 'Inter', sans-serif; background-color: #0f172a; color: white; }

        #card-wrapper {
            padding: 0; margin: 0; display: inline-block;
            filter: drop-shadow(0 30px 50px rgba(0,0,0,0.7));
        }

        #card-preview {
            width: 600px; height: 378px; position: relative;
            border-radius: 24px; overflow: hidden; border: none;
            /* Flexbox Layout yang Aman */
            display: flex; flex-direction: column; justify-content: space-between;
            padding: 40px;
        }

        /* --- BACKGROUND SHINE (LAYER PALING BAWAH) --- */
        .shine-layer {
            position: absolute; top: 0; left: 0; right: 0; bottom: 0;
            background: linear-gradient(125deg, rgba(255,255,255,0) 35%, rgba(255,255,255,0.1) 45%, rgba(255,255,255,0) 55%);
            z-index: 1; /* Pastikan di bawah teks */
            pointer-events: none;
        }

        /* --- KONTAINER KONTEN (LAYER PALING ATAS) --- */
        /* Ini kunci agar teks muncul di Windows: Z-Index tinggi */
        .card-content-layer {
            position: relative;
            z-index: 50; /* Jauh di atas background */
            width: 100%;
        }

        /* --- STYLING NAMA TOKO (SOLID COLOR FIX) --- */
        .brand-name {
            font-family: 'Oswald', Arial, sans-serif;
            font-size: 32px;
            font-weight: 800;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            white-space: nowrap;
            line-height: 1.2;
            /* Ganti Gradient dengan Solid Color agar tidak hilang/blocky */
            color: #FFD700; 
            filter: drop-shadow(0 2px 4px rgba(0,0,0,0.5));
        }

        /* --- BADGE LEVEL --- */
        .badge-outer { 
            margin-top: 8px; 
            display: flex; align-items: center; justify-content: flex-start;
        }
        #cardLevelText {
            font-family: 'Inter', Arial, sans-serif;
            font-size: 14px; font-weight: 800; text-transform: uppercase;
            letter-spacing: 0.35em; color: white; line-height: 1.2;
            text-shadow: 0 2px 8px rgba(0,0,0,0.6);
        }

        /* --- NAMA PEMEGANG & INFO --- */
        .holder-label { 
            font-size: 10px; opacity: 0.8; text-transform: uppercase; 
            letter-spacing: 0.2em; font-weight: 600; margin-bottom: 5px; display: block;
            color: white;
        }
        
        #cardName {
            font-family: 'Inter', Arial, sans-serif;
            font-size: 38px; font-weight: 800; line-height: 1.2;
            margin: 0; white-space: nowrap; display: block;
            text-shadow: 0 2px 10px rgba(0,0,0,0.5);
            padding-bottom: 5px;
            color: white; /* Paksa warna putih */
        }

        .meta-info { display: flex; gap: 40px; margin-top: 20px; }
        .meta-label { font-size: 9px; opacity: 0.8; text-transform: uppercase; font-weight: 700; margin-bottom: 2px; color: white;}
        .meta-value { font-family: monospace; font-size: 20px; font-weight: 700; line-height: 1; color: white; }

        /* --- THEMES --- */
        .level-bronze { background: linear-gradient(135deg, #8E5C38 0%, #C9966D 100%); }
        /* Fix Bronze: Brand Putih Solid */
        .level-bronze .brand-name { color: #FFFFFF; text-shadow: 0 2px 10px rgba(0,0,0,0.8); }

        .level-silver { background: linear-gradient(135deg, #F5F7FA 0%, #B8C6DB 100%); }
        /* Fix Silver: Teks Gelap Solid */
        .level-silver .brand-name { color: #2c3e50; filter: none; }
        .level-silver #cardLevelText, .level-silver #cardName, .level-silver .holder-label, .level-silver .meta-label, .level-silver .meta-value { 
            color: #1a202c !important; text-shadow: none; 
        }

        .level-gold { background: linear-gradient(135deg, #BF953F 0%, #FCF6BA 25%, #B38728 50%, #FBF5B7 75%, #AA771C 100%); }
        /* Fix Gold: Teks Cokelat Solid */
        .level-gold .brand-name { color: #422a02; filter: none; }
        .level-gold #cardLevelText, .level-gold #cardName, .level-gold .holder-label, .level-gold .meta-label, .level-gold .meta-value { 
            color: #422a02 !important; text-shadow: none; 
        }

        .level-platinum { background: linear-gradient(135deg, #434343 0%, #000000 100%); }
        /* Platinum tetap Emas Solid */

        .level-diamond { background: radial-gradient(circle at 100% 0%, #00c6ff 0%, #0072ff 60%, #002a8f 100%); }
        
        .level-infinite { background: radial-gradient(circle at 50% 50%, #1a1a1a 0%, #000000 100%); }
        .level-infinite .brand-name { color: #D4AF37; }
        .level-infinite #cardLevelText, .level-infinite #cardName { color: #D4AF37; }

    </style>
</head>
<body class="p-4 md:p-8 flex items-center justify-center min-h-screen bg-gray-900">

    <div class="max-w-7xl w-full grid grid-cols-1 lg:grid-cols-12 gap-10">
        <div class="lg:col-span-4 bg-white text-gray-800 p-6 rounded-2xl shadow-xl h-fit">
            <h2 class="text-xl font-bold mb-4 border-b pb-2 text-indigo-600">Database & Management</h2>
            <div class="space-y-4">
                <div>
                    <label class="text-[10px] font-bold text-gray-400 uppercase">Pilih Level</label>
                    <select id="inputLevel" class="w-full p-2 border rounded bg-gray-50 font-bold" onchange="updateCard()">
                        <option value="bronze">BRONZE</option>
                        <option value="silver">SILVER</option>
                        <option value="gold">GOLD</option>
                        <option value="platinum">PLATINUM</option>
                        <option value="diamond">DIAMOND</option>
                        <option value="infinite">INFINITE</option>
                    </select>
                </div>
                <div>
                    <label class="text-[10px] font-bold text-gray-400 uppercase">Nama Member</label>
                    <input type="text" id="inputName" class="w-full p-2 border rounded font-bold" value="HERRY WIJAYA" oninput="updateCard()">
                </div>
                <div>
                    <label class="text-[10px] font-bold text-gray-400 uppercase">ID Member (Editable)</label>
                    <div class="flex gap-2">
                        <input type="text" id="inputId" class="w-full p-2 border border-orange-200 bg-orange-50 rounded font-mono font-bold" value="M-882190" oninput="updateCard()">
                        <button onclick="generateUniqueRandomID()" class="px-4 bg-gray-200 rounded hover:bg-gray-300 font-bold">â†»</button>
                    </div>
                </div>
                <div>
                    <label class="text-[10px] font-bold text-gray-400 uppercase">NIK (KTP)</label>
                    <input type="text" id="inputNIK" class="w-full p-2 border border-blue-100 bg-blue-50 rounded font-mono" placeholder="XXXX-XXXX-XXXX-XXXX" maxlength="19">
                </div>
                <div class="grid grid-cols-2 gap-3 pt-4">
                    <button onclick="saveToDatabase()" class="bg-green-600 text-white py-3 rounded-xl font-bold hover:bg-green-700">ðŸ’¾ Simpan</button>
                    <button onclick="downloadHD()" class="bg-indigo-600 text-white py-3 rounded-xl font-bold hover:bg-indigo-700">ðŸ“¥ Download HD</button>
                </div>
            </div>
        </div>

        <div class="lg:col-span-8 flex flex-col items-center justify-center">
            <div id="card-wrapper">
                <div id="card-preview" class="level-bronze">
                    
                    <div class="shine-layer"></div>
                    
                    <div class="card-content-layer flex flex-col justify-between h-full">
                        
                        <div class="flex justify-between items-start">
                            <div>
                                <div class="brand-name italic">SUMBER SARI PATIMURA</div>
                                <div class="badge-outer">
                                    <span id="cardLevelText">BRONZE MEMBER</span>
                                </div>
                            </div>
                            <div class="w-14 h-14 bg-white/10 backdrop-blur-md rounded-full flex items-center justify-center border border-white/20">
                                <svg class="w-7 h-7 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-width="2" d="M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z"></path></svg>
                            </div>
                        </div>

                        <div class="flex justify-between items-end">
                            <div class="flex-1">
                                <span class="holder-label">Card Holder</span>
                                <h2 id="cardName">HERRY WIJAYA</h2>
                                <div class="meta-info">
                                    <div><p class="meta-label">ID Member</p><p id="cardId" class="meta-value">M-882190</p></div>
                                    <div><p class="meta-label">Joined</p><p class="meta-value">Des 2023</p></div>
                                </div>
                            </div>
                            <div class="bg-white p-2 rounded-2xl shadow-xl shrink-0">
                                <div id="qrcode"></div>
                            </div>
                        </div>
                        
                    </div>
                </div>
            </div>
            <p class="text-gray-500 text-xs mt-6 uppercase tracking-widest font-bold">V24: Windows Safe Mode (Z-Index Fixed)</p>
        </div>
    </div>

    <script>
        document.getElementById('inputNIK').addEventListener('input', function(e) {
            let v = e.target.value.replace(/\D/g,'').slice(0,16);
            e.target.value = v.replace(/(\d{4})(?=\d)/g, '$1-');
        });

        function getDatabase() { return JSON.parse(localStorage.getItem('memberDB_Final')) || []; }

        function generateUniqueRandomID() {
            const db = getDatabase();
            let newID;
            do { newID = "M-" + (Math.floor(Math.random() * 900000) + 100000); } 
            while (db.some(m => m.id === newID));
            document.getElementById('inputId').value = newID;
            updateCard();
        }

        function updateCard() {
            const level = document.getElementById('inputLevel').value;
            const name = document.getElementById('inputName').value.toUpperCase();
            const id = document.getElementById('inputId').value.toUpperCase();
            
            document.getElementById('cardName').innerText = name || 'NAMA MEMBER';
            document.getElementById('cardId').innerText = id || 'M-000000';
            document.getElementById('cardLevelText').innerText = level + ' MEMBER';
            
            const preview = document.getElementById('card-preview');
            preview.className = `level-${level}`; // Reset class

            const qrContainer = document.getElementById('qrcode');
            qrContainer.innerHTML = "";
            new QRCode(qrContainer, { text: id, width: 80, height: 80 });
        }

        function saveToDatabase() {
            const data = { 
                id: document.getElementById('inputId').value, 
                nik: document.getElementById('inputNIK').value, 
                name: document.getElementById('inputName').value 
            };
            let db = getDatabase();
            db.push(data);
            localStorage.setItem('memberDB_Final', JSON.stringify(db));
            alert("Data Tersimpan di Windows ini!");
        }

        function downloadHD() {
            const card = document.getElementById('card-preview');
            const btn = event.currentTarget;
            btn.innerHTML = "â³ RENDERING..."; btn.disabled = true;
            
            html2canvas(card, {
                scale: 4,
                backgroundColor: null,
                useCORS: true,
                allowTaint: true,
                // Matikan fitur yang sering bug di Windows
                letterRendering: false 
            }).then(canvas => {
                const link = document.createElement('a');
                link.download = `Member_SS_Patimura_${document.getElementById('inputId').value}.png`;
                link.href = canvas.toDataURL("image/png");
                link.click();
                btn.innerHTML = "ðŸ“¥ Download HD"; btn.disabled = false;
            });
        }

        window.onload = function() { generateUniqueRandomID(); };
    </script>
</body>
</html>
