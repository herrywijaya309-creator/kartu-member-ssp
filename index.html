<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Member Card - Sumber Sari Patimura V22</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&family=Oswald:wght@500;700&display=swap" rel="stylesheet">

    <style>
        body { font-family: 'Inter', sans-serif; background-color: #0f172a; color: white; }

        #card-wrapper {
            padding: 0; margin: 0; display: inline-block;
            filter: drop-shadow(0 30px 50px rgba(0,0,0,0.7));
        }

        #card-preview {
            width: 600px; height: 378px; position: relative;
            border-radius: 24px; overflow: hidden; border: none;
            box-sizing: border-box;
        }

        /* --- STYLING NAMA TOKO (FIXED: NO BACKGROUND CLIP TO AVOID BLOCKS) --- */
        .brand-name {
            font-family: 'Oswald', sans-serif;
            font-size: 32px;
            font-weight: 800;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            white-space: nowrap;
            /* Menggunakan warna solid yang menyerupai emas untuk stabilitas download */
            color: #FFD700; 
            -webkit-background-clip: unset;
            -webkit-text-fill-color: currentColor;
            filter: drop-shadow(0 2px 4px rgba(0,0,0,0.3));
        }

        /* --- BADGE LEVEL --- */
        .badge-outer { margin-top: 4px; display: flex; align-items: center; }
        #cardLevelText {
            font-size: 14px; font-weight: 800; text-transform: uppercase;
            letter-spacing: 0.35em; color: white; line-height: 1;
            text-shadow: 0 2px 10px rgba(0,0,0,0.5);
        }

        /* --- NAMA PEMEGANG --- */
        .holder-label { font-size: 10px; opacity: 0.75; text-transform: uppercase; letter-spacing: 0.2em; font-weight: 600; margin-bottom: 4px; display: block; }
        #cardName {
            font-size: 38px; font-weight: 800; line-height: 1.2;
            margin: 0; white-space: nowrap; display: block;
            text-shadow: 0 2px 15px rgba(0,0,0,0.4);
            max-width: 380px; overflow: hidden; text-overflow: ellipsis;
            padding-bottom: 15px; margin-bottom: -15px;
        }

        /* --- THEMES (FIX WARNA BRAND AGAR TIDAK BLOCKY) --- */
        .level-bronze { background: linear-gradient(135deg, #8E5C38 0%, #C9966D 100%); }
        .level-bronze .brand-name { color: #F5F5F5; } /* Putih Kristal */

        .level-silver { background: linear-gradient(135deg, #F5F7FA 0%, #B8C6DB 100%); color: #1a202c; }
        .level-silver .brand-name { color: #2c3e50; } 
        .level-silver #cardLevelText, .level-silver #cardName, .level-silver .holder-label, .level-silver #cardId, .level-silver .since-text { color: #1a202c; text-shadow: none; }

        .level-gold { background: linear-gradient(135deg, #BF953F 0%, #FCF6BA 25%, #B38728 50%, #FBF5B7 75%, #AA771C 100%); color: #3e2b00; }
        .level-gold .brand-name { color: #422a02; }
        .level-gold #cardLevelText, .level-gold #cardName, .level-gold .holder-label, .level-gold #cardId, .level-gold .since-text { color: #422a02; text-shadow: none; }

        .level-platinum { background: linear-gradient(135deg, #434343 0%, #000000 100%); }
        .level-platinum .brand-name { color: #FFD700; }

        .level-diamond { background: radial-gradient(circle at 100% 0%, #00c6ff 0%, #0072ff 60%, #002a8f 100%); }
        .level-diamond .brand-name { color: #FFD700; }

        .level-infinite { background: radial-gradient(circle at 50% 50%, #1a1a1a 0%, #000000 100%); color: #D4AF37; }
        .level-infinite .brand-name { color: #D4AF37; }
        .level-infinite #cardLevelText, .level-infinite #cardName { color: #D4AF37; text-shadow: 0 0 15px rgba(212, 175, 55, 0.4); }

        .shine-layer { position: absolute; top: 0; left: 0; right: 0; bottom: 0; background: linear-gradient(125deg, rgba(255,255,255,0) 35%, rgba(255,255,255,0.1) 45%, rgba(255,255,255,0) 55%); z-index: 1; pointer-events: none; }
    </style>
</head>
<body class="p-4 md:p-8 flex items-center justify-center min-h-screen bg-gray-900">

    <div class="max-w-7xl w-full grid grid-cols-1 lg:grid-cols-12 gap-10">
        <div class="lg:col-span-4 bg-white text-gray-800 p-6 rounded-2xl shadow-xl h-fit">
            <h2 class="text-xl font-bold mb-4 border-b pb-2 text-indigo-600">Database & Management</h2>
            <div class="space-y-4">
                <div>
                    <label class="text-[10px] font-bold text-gray-400 uppercase">Pilih Level</label>
                    <select id="inputLevel" class="w-full p-2 border rounded bg-gray-50 font-bold" onchange="updateCard()">
                        <option value="bronze">BRONZE</option>
                        <option value="silver">SILVER</option>
                        <option value="gold">GOLD</option>
                        <option value="platinum">PLATINUM</option>
                        <option value="diamond">DIAMOND</option>
                        <option value="infinite">INFINITE</option>
                    </select>
                </div>
                <div>
                    <label class="text-[10px] font-bold text-gray-400 uppercase">Nama Member</label>
                    <input type="text" id="inputName" class="w-full p-2 border rounded font-bold" value="HERRY WIJAYA" oninput="updateCard()">
                </div>
                <div>
                    <label class="text-[10px] font-bold text-gray-400 uppercase">ID Member (Editable)</label>
                    <div class="flex gap-2">
                        <input type="text" id="inputId" class="w-full p-2 border border-orange-200 bg-orange-50 rounded font-mono font-bold" value="M-882190" oninput="updateCard()">
                        <button onclick="generateUniqueRandomID()" class="px-4 bg-gray-200 rounded hover:bg-gray-300 font-bold">â†»</button>
                    </div>
                </div>
                <div>
                    <label class="text-[10px] font-bold text-gray-400 uppercase">NIK (KTP)</label>
                    <input type="text" id="inputNIK" class="w-full p-2 border border-blue-100 bg-blue-50 rounded font-mono" placeholder="XXXX-XXXX-XXXX-XXXX" maxlength="19">
                </div>
                <div class="grid grid-cols-2 gap-3 pt-4">
                    <button onclick="saveToDatabase()" class="bg-green-600 text-white py-3 rounded-xl font-bold">ðŸ’¾ Simpan</button>
                    <button onclick="downloadHD()" class="bg-indigo-600 text-white py-3 rounded-xl font-bold">ðŸ“¥ Download HD</button>
                </div>
            </div>
        </div>

        <div class="lg:col-span-8 flex flex-col items-center justify-center">
            <div id="card-wrapper">
                <div id="card-preview" class="level-bronze p-10 flex flex-col justify-between relative">
                    <div class="shine-layer"></div>
                    
                    <div class="flex justify-between items-start z-10 relative">
                        <div>
                            <div class="brand-name italic">SUMBER SARI PATIMURA</div>
                            <div class="badge-outer">
                                <span id="cardLevelText">BRONZE MEMBER</span>
                            </div>
                        </div>
                        <div class="w-14 h-14 bg-white/10 backdrop-blur-md rounded-full flex items-center justify-center border border-white/20">
                            <svg class="w-7 h-7 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-width="2" d="M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z"></path></svg>
                        </div>
                    </div>

                    <div class="flex justify-between items-end z-10 relative">
                        <div class="flex-1">
                            <span class="holder-label">Card Holder</span>
                            <h2 id="cardName">HERRY WIJAYA</h2>
                            <div class="flex gap-10 mt-6">
                                <div><p class="text-[9px] opacity-60 uppercase font-bold since-text">ID Member</p><p id="cardId" class="font-mono text-2xl font-bold">M-882190</p></div>
                                <div><p class="text-[9px] opacity-60 uppercase font-bold since-text">Joined</p><p class="text-2xl font-bold since-text">Des 2023</p></div>
                            </div>
                        </div>
                        <div class="bg-white p-2 rounded-2xl shadow-xl">
                            <div id="qrcode"></div>
                        </div>
                    </div>
                </div>
            </div>
            <p class="text-gray-500 text-xs mt-6 uppercase tracking-widest font-bold">V22: Fixed Text Rendering Engine</p>
        </div>
    </div>

    <script>
        document.getElementById('inputNIK').addEventListener('input', function(e) {
            let v = e.target.value.replace(/\D/g,'').slice(0,16);
            e.target.value = v.replace(/(\d{4})(?=\d)/g, '$1-');
        });

        function getDatabase() { return JSON.parse(localStorage.getItem('memberDB_Final')) || []; }

        function generateUniqueRandomID() {
            const db = getDatabase();
            let newID;
            do { newID = "M-" + (Math.floor(Math.random() * 900000) + 100000); } 
            while (db.some(m => m.id === newID));
            document.getElementById('inputId').value = newID;
            updateCard();
        }

        function updateCard() {
            const level = document.getElementById('inputLevel').value;
            const name = document.getElementById('inputName').value.toUpperCase();
            const id = document.getElementById('inputId').value.toUpperCase();
            document.getElementById('cardName').innerText = name || 'NAMA MEMBER';
            document.getElementById('cardId').innerText = id || 'M-000000';
            document.getElementById('cardLevelText').innerText = level + ' MEMBER';
            const preview = document.getElementById('card-preview');
            preview.className = `level-${level} p-10 flex flex-col justify-between relative`;
            const qrContainer = document.getElementById('qrcode');
            qrContainer.innerHTML = "";
            new QRCode(qrContainer, { text: id, width: 80, height: 80 });
        }

        function saveToDatabase() {
            const data = { id: document.getElementById('inputId').value, nik: document.getElementById('inputNIK').value, name: document.getElementById('inputName').value };
            let db = getDatabase();
            db.push(data);
            localStorage.setItem('memberDB_Final', JSON.stringify(db));
            alert("Data Berhasil Disimpan!");
        }

        function downloadHD() {
            const card = document.getElementById('card-preview');
            const btn = event.currentTarget;
            btn.innerHTML = "â³ RENDERING..."; btn.disabled = true;
            
            // Menggunakan html2canvas dengan opsi yang meminimalkan glitch pada teks
            html2canvas(card, { 
                scale: 4, 
                backgroundColor: null, 
                useCORS: true,
                allowTaint: true,
                letterRendering: true // Mengoptimalkan render teks
            }).then(canvas => {
                const link = document.createElement('a');
                link.download = `Member_SS_Patimura_${document.getElementById('inputId').value}.png`;
                link.href = canvas.toDataURL("image/png");
                link.click();
                btn.innerHTML = "ðŸ“¥ Download HD"; btn.disabled = false;
            });
        }

        window.onload = function() { updateCard(); };
    </script>
</body>
</html>